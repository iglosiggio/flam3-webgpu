<!DOCTYPE html>
<html>
    <head>
        <title>FLAM3 on WebGPU</title>
        <script type="module" src="main.js">
        </script>
        <meta http-equiv="origin-trial" content="Athxt2w9w8TlIoxz7sUGbJxSP3CxVd1k92JUkY07sUajpbpVhPBjYt/N3lHPr77aRO+LQDCruKyh4hiJ6xYf8woAAABUeyJvcmlnaW4iOiJodHRwczovL2lnbG9zaWdnaW8uZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJXZWJHUFUiLCJleHBpcnkiOjE2NTI4MzE5OTl9">
        <style>
            body {
                font-family: sans-serif;
                margin: 0;
                background-color: rgb(255, 255, 255);
            }
            .intro {
                margin: auto;
                max-width: 700px;
            }
            .intro h1, .intro h2, .intro h3 {
                text-align: right;
                line-height: 0.5em;
            }
            main {
                width: 100%;
                text-align: center;
                background-color: rgb(72, 61, 139);
            }
            #fractal-viewer, #xforms {
                display: inline-block;
                vertical-align: middle;
                margin-top: 0.4em;
                margin-bottom: 0.4em;
            }
            #controls {
                text-align: center;
            }
            #xforms {
                background-color: rgb(166, 152, 252);
                border-radius: 0px 10px 30px 10px;
            }
            xform-editor {
                text-align: left;
                display: block;
                padding: 1em 1em;

                border-color: rgb(72, 61, 139);
                border-style: dashed;
                border-width: 0.0em 0em 0.01em 0em;
            }
            xform-editor:last-child {
                border-width: 0em;
            }
        </style>
    </head>
    <body>
        <template id="xform-editor-template">
            <style>
                .vector {
                    vertical-align: middle;
                    display: inline-block;
                    border-color: black;
                    border-style: solid;
                    border-width: 0em 0.01em 0em 0.01em;
                    border-radius: 0.3em;
                }
                .affine-transform {
                    display: block;
                    min-width: 200px;
                    margin-top: 0.2em;
                }
                .vector td {
                    text-align: right;
                }
            </style>
            <i>Variation:</i>
            <select>
                <option>linear</option>
                <option>sinusoidal</option>
                <option>julia</option>
                <option>eyefish</option>
            </select>
            <button>Remove</button>
            <div class="affine-transform">
                <table class="vector">
                    <tr>
                        <td><slot name="a">a</slot></td>
                        <td><slot name="b">b</slot></td>
                    </tr>
                    <tr>
                        <td><slot name="d">d</slot></td>
                        <td><slot name="e">e</slot></td>
                    </tr>
                </table>
                <table class="vector">
                    <tr><td>x</td></tr>
                    <tr><td>y</td></tr>
                </table>
                 +
                <table class="vector">
                    <tr><td><slot name="c">c</slot></td></tr>
                    <tr><td><slot name="f">f</slot></td></tr>
                </table>
            </div>
        </template>
        <main>
            <h1 id="webgpu-not-supported-error" style="display: none;">WebGPU support was not detected</h1>
            <h1 id="webgpu-no-device-error" style="display: none;">No WebGPU device is available</h1>
            <div id="fractal-viewer">
                <canvas id="output" width="900" height="900">
                    Sorry, your browser has no canvas support
                </canvas>
                <div id="controls">
                    <button onclick="flam3.start()"          id="flam3-start">Start     </button>
                    <button onclick="flam3.stop()"           id="flam3-stop" >Stop      </button>
                    <button onclick="flam3.step()"           id="flam3-step" >Step      </button>
                    <button onclick="flam3.clear()"          id="flam3-clear">Clear     </button>
                    <button onclick="flam3.gui = !flam3.gui" id="flam3-gui"  >Toggle GUI</button>
                </div>
            </div>
            <div id="xforms"></div>
        </main>
        <div class="intro">
<h1>What the hell is that?</h1>
<h2>Alternative title: <i>"Easy FLAM3 fractal rendering on WebGPU"</i></h2>
<h3>by mega</h3>
<p>At some point I will put some explanation of how the implementation works and what the triangles mean. For now you can check the <a href="https://flam3.com/flame_draves.pdf">original paper</a> and the <a href="https://github.com/iglosiggio/flam3-webgpu">sources for this site</a>. If something is still unclear feel free to reach out to me :)</p>
<p>The implementation is made on <a href="https://tc39.es/ecma262/">JavaScript</a> and <a href="https://gpuweb.github.io/gpuweb/">WebGPU</a> (using <a href="https://gpuweb.github.io/gpuweb/wgsl/">WGSL</a> shaders).</p>
        </div>
        <script type="text/javascript">
            customElements.define('xform-editor', class extends HTMLElement {
                static get observedAttributes() {
                    return ['variation', 'a', 'b', 'c', 'd', 'e', 'f']
                }
                constructor() {
                    super();
                    const template = document.getElementById('xform-editor-template')
                                             .content;
                    this.attachShadow({mode: 'open'})
                        .appendChild(template.cloneNode(true));
                    this.xform = undefined
                }
                attributeChangedCallback(name, oldValue, newValue) {
                    if (this.constructor.observedAttributes.includes(name))
                        if (name !== 'variation')
                            this.shadowRoot.querySelector(`slot[name="${name}"]`).textContent = newValue
                        else
                            this.shadowRoot.querySelector('select').value = newValue
                    else
                        console.warn(`Unknown attribute ${name} changed from ${oldValue} to ${newValue}`)
                }
            });
        </script>
    </body>
</html>
